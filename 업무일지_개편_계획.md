# 업무일지 시스템 개편 계획

## 📋 프로젝트 개요

### 목표
- 고정된 템플릿 기반 업무일지 시스템 구축
- 실시간 자동 저장 (로컬스토리지 + DB)
- TO-DO 관리 기능 강화 (추가/완료 이동)
- 편집 기능 제거, 구조화된 템플릿만 사용

### 핵심 변경사항
1. **템플릿 고정화**: 편집 불가능한 구조화된 양식
2. **실시간 저장**: 로컬스토리지(1초) + DB(5초) 자동 저장
3. **TO-DO 관리**: 오늘 할 일 → 완료한 일 이동 기능
4. **접근성 개선**: :  **기존 템플릿 페이지를 업무일지 작성 페이지로 전환**

## 🏗️ 기술 스택 및 아키텍처

### 기술 스택
- **Frontend**: Next.js 15, React 19, TypeScript
- **State**: Zustand (업무일지 상태 관리)
- **Storage**: LocalStorage (임시 저장) + Supabase (영구 저장)
- **UI**: Tailwind CSS, Framer Motion (애니메이션)

### 데이터 구조
```typescript
interface WorkLog {
  id: string;
  user_id: string;
  date: string;
  todos: TodoItem[];
  completed_todos: TodoItem[];
  roi_high: string;
  roi_low: string;
  tomorrow_priority: string;
  feedback: string;
  created_at: string;
  updated_at: string;
}

interface TodoItem {
  id: string;
  text: string;
  completed: boolean;
  order: number;
}
```

## 📝 구현 단계

### Phase 1: 기존 코드 분석 및 정리
**예상 시간**: 30분

1. **기존 업무일지 관련 파일 분석**
   - `components/work-log/WorkLogModal.tsx`
   - `components/work-log/WorkLogTemplateModal.tsx` → **업무일지 작성 페이지로 전환**
   - `app/(main)/template/page.tsx` → **업무일지 작성 페이지로 변경**
   - `app/api/work-logs/route.ts`
   - `app/api/work-log-template/route.ts` → **제거 예정**

2. **DB 스키마 확인**
   - `work_logs` 테이블 구조 분석
   - `work_log_template` 테이블 제거 필요성 검토

3. **의존성 파악**
   - 퇴근 플로우와의 연결 지점
   - 업무일지 조회 페이지와의 연동

### Phase 2: DB 스키마 업데이트
**예상 시간**: 30분

1. **work_logs 테이블 수정**
   ```sql
   -- 새로운 컬럼 추가
   ALTER TABLE work_logs
   ADD COLUMN todos JSONB DEFAULT '[]',
   ADD COLUMN completed_todos JSONB DEFAULT '[]',
   ADD COLUMN roi_high TEXT,
   ADD COLUMN roi_low TEXT,
   ADD COLUMN tomorrow_priority TEXT,
   ADD COLUMN feedback TEXT;
   ```

2. **RLS 정책 검토 및 수정**
   - 사용자별 접근 권한 확인
   - 실시간 업데이트를 위한 정책 추가

### Phase 3: Zustand Store 구현
**예상 시간**: 45분

1. **WorkLogStore 생성** (`lib/stores/work-log-store.ts`)
   - 업무일지 상태 관리
   - 로컬스토리지 동기화
   - DB 동기화 로직

2. **주요 기능**
   - `loadTodayLog()`: 오늘 업무일지 불러오기/생성
   - `updateField()`: 필드 업데이트
   - `addTodo()`: TO-DO 추가
   - `toggleTodo()`: TO-DO 완료 처리
   - `moveTodoToCompleted()`: 완료 항목으로 이동
   - `saveToLocalStorage()`: 로컬스토리지 저장
   - `saveToDB()`: DB 저장

### Phase 4: 템플릿 페이지를 업무일지 작성 페이지로 전환
**예상 시간**: 1시간 30분

1. **Template 페이지 개편** (`app/(main)/template/page.tsx`)
   - 기존 템플릿 편집 기능 제거
   - 업무일지 작성 인터페이스로 전환
   - 실시간 편집 가능한 폼

2. **TodoSection 컴포넌트** (`components/work-log/TodoSection.tsx`)
   - TO-DO 추가/삭제/완료 기능
   - 체크박스로 완료 처리
   - 완료 시 "완료한 일" 섹션으로 자동 이동

3. **ROISection 컴포넌트** (`components/work-log/ROISection.tsx`)
   - ROI 자가 진단 3개 질문
   - 텍스트 입력 필드

4. **FeedbackSection 컴포넌트** (`components/work-log/FeedbackSection.tsx`)
   - 자가 피드백 텍스트 영역

### Phase 5: 자동 저장 로직 구현
**예상 시간**: 45분

1. **useAutoSave Hook 구현**
   - 디바운스 로직 (1초)
   - 로컬스토리지 저장
   - DB 저장 큐 관리

2. **저장 전략**
   - 입력 변경 → 1초 디바운스 → 로컬스토리지
   - 5초마다 변경사항 체크 → DB 저장
   - 페이지 이탈 시 즉시 저장
   - 네트워크 오류 시 재시도 로직

### Phase 6: 퇴근 플로우 수정
**예상 시간**: 30분

1. **CheckoutButton 수정**
   - 업무일지 확인 모달 표시
   - 읽기 전용 뷰로 표시

2. **WorkLogConfirmModal 구현**
   - 오늘 작성한 업무일지 요약 표시
   - "확인 후 퇴근" 버튼

### Phase 7: 네비게이션 및 출근 플로우 통합
**예상 시간**: 30분

1. **네비게이션 메뉴 수정**
   - "템플릿" → "업무일지" 메뉴명 변경
   - 아이콘 업데이트 (필요시)

2. **출근 시 업무일지 생성**
   - 출근 API 수정
   - 새 업무일지 자동 생성 로직
   - 출근 날짜 기준으로 업무일지 생성

### Phase 8: API 엔드포인트 수정
**예상 시간**: 45분

1. **work-logs API 수정**
   - GET: 오늘 업무일지 조회/생성
   - PATCH: 부분 업데이트 (자동 저장용)
   - POST: 새 업무일지 생성

2. **에러 처리**
   - 중복 생성 방지
   - 동시성 제어

### Phase 9: 테스트 및 최적화
**예상 시간**: 1시간

1. **기능 테스트**
   - 자동 저장 동작 확인
   - TO-DO 이동 기능 테스트
   - 퇴근 플로우 테스트

2. **성능 최적화**
   - 불필요한 리렌더링 방지
   - 디바운스 시간 조정
   - 네트워크 요청 최적화

3. **엣지 케이스 처리**
   - 네트워크 끊김
   - 동시 편집 (추후 고려)
   - 브라우저 강제 종료

## 🎯 주요 고려사항

### UX 개선 포인트
1. **저장 상태 표시**: 저장 중/저장 완료 인디케이터
2. **충돌 방지**: 로컬스토리지와 DB 동기화 전략
3. **데이터 복구**: 실수로 삭제한 TO-DO 복구 기능 (Undo)

### 기술적 과제
1. **실시간 동기화**: 여러 탭/기기에서 접근 시
2. **오프라인 지원**: 네트워크 없을 때도 작업 가능
3. **마이그레이션**: 기존 업무일지 데이터 처리

## 📊 예상 타임라인

- **총 예상 시간**: 약 7시간
- **우선순위**:
  1. Phase 1-3: 기반 작업 (2시간)
  2. Phase 4-5: 핵심 기능 (2시간 15분)
  3. Phase 6-8: 통합 작업 (1시간 45분)
  4. Phase 9: 품질 보증 (1시간)

## 🚀 배포 계획

1. **개발 환경 테스트**
2. **기존 데이터 백업**
3. **DB 마이그레이션 실행**
4. **단계적 배포** (선택적 기능 플래그 사용)
5. **모니터링 및 피드백 수집**

## 📌 참고사항

- 템플릿 편집 기능은 완전히 제거
- 과거 업무일지는 기존 조회 페이지에서 확인
- 추후 팀 공유 기능 고려 가능
- **기존 템플릿 페이지를 업무일지 작성 페이지로 완전 대체**
- **URL 경로는 `/template` 유지 가능 또는 `/work-log`로 변경 고려**